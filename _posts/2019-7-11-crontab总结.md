---
layout: post
title:  "crontab总结"
date:   2019-06-20 00:18:23 +0700
categories: [crontab]
tags:  crontab
comments: true
---

摘要：如何使用crontab设置定时任务，并给出相关实例。

------

## crontab介绍

crond是linux平台下实现计划任务的一项服务。crontab只是一个文件，提供给crond计划任务的配置文件。先来看看这个配置文件：

*cat /etc/crontab*

![crontab格式说明]({{ "/assets/img/sample/crontab_1.jpg" | relative_url }})

第一行：SHELL变量指定了系统要使用哪个shell，这里是bash;

第二行：PATH变量指定了系统执行命令的路径;

第三行：MAILTO变量指定了crond的任务执行信息将通过电子邮件发送给root用户，如果MAILTO变量的值为空，则表示不发送任务执行信息给用户。

图中已经描述得比较清楚了，crontab的语法格式就是用5个 * 表示定时任务的执行时间：分别是：分钟、小时、天、月、周。

minute的取值范围是 0-59
hour的取值范围是0-23
day的取值范围是1-31
mouth的取值范围是1-12
day of week 的取值范围是 0-6 / sun  mon  tue  wed  thu  fri  sat

还可以使用以下特殊字符：
* 星号（ \* ）：代表所有可能的值，例如:month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。
* 逗号（ , ）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9” 中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6” 。
* 正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如 \*/10，如果用在minute字段，表示每十分钟执行一次。

## crontab常用命令

example:

crontab -e 进入vim编辑一个计划任务；

crontab -l 列出当前用户计划任务，每一行代表一个计划任务。

-u user：用来设定某个用户的crontab服务；

-e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。

-l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。

-r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。

-i：在删除用户的crontab文件时给确认提示。

可以执行man crontab查看文档。注意计划任务写完了之后要重启crond服务。

## crontab实例分析

``` shell
0 */2 * * * . /etc/profile; /bin/sh /usr/tmp/excute.sh
```
说明：
0 \*/2 \* \* \* 代表没两个小时执行一次，分钟位置为0。每两个小时执行一次，每个小时的第0分钟执行任务，如果分钟位置为\*，表达的意思是每两个小时执行，并且每分钟执行一次。
. /etc/profile 表示source环境变量，相当于source /etc/profile，注意 . 的后面是有空格的，. 相当于是一个命令了。
/bin/sh 指定shell类型。
/usr/tmp/excute.sh 指定计划任务需要执行的shell脚本。注意最好写全路径。

## 需要注意的问题

> 在crontab文件中定义多个调度任务时，需要特别注环境变量的设置，因为我们手动执行某个任务时，是在当前shell环境下进行的，程序当然能找到环境变量，而系统自动执行任务调度时，是不会加载任何环境变量的，因此，就需要在crontab文件中指定任务运行所需的所有环境变量，这样，系统执行任务调度时就没有问题了。不要假定cron知道所需要的特殊环境，它其实并不知道。所以你要保证在shelll脚本中提供所有必要的路径和环境变量，除了一些自动设置的全局变量。所以注意如下3点：

脚本中涉及文件路径时写全局路径；

脚本执行要用到java或其他环境变量时，通过source命令引入环境变量，如:
``` shell
cat start_cbp.sh
!/bin/sh
source /etc/profile
export RUN_CONF=/home/d139/conf/platform/cbp/cbp_jboss.conf
/usr/local/jboss-4.0.5/bin/run.sh -c mev &
```

当手动执行脚本OK，但是crontab不执行时,很可能是环境变量惹的祸，可尝试在crontab中直接引入环境变量解决问题。如:
``` shell
0 * * * * . /etc/profile;/bin/sh /var/www/java/audit_no_count/bin/restart_audit.sh
```

## crontab具体实例

``` shell

#实例1：每1分钟执行一次Command
* * * * * Command


#实例2：每小时的第3和第15分钟执行
3,15 * * * * Command


#实例3：在上午8点到11点的第3和第15分钟执行
3,15 8-11 * * * Command


#实例4：每隔两天的上午8点到11点的第3和第15分钟执行
3,15 8-11 */2  *  * Command


#实例5：每周一上午8点到11点的第3和第15分钟执行
3,15 8-11 * * 1 Command


#实例6：每晚的21:30重启smb
30 21 * * * /etc/init.d/smb restart


#实例7：每月1、10、22日的4 : 45重启smb
45 4 1,10,22 * * /etc/init.d/smb restart


#实例8：每周六、周日的1 : 10重启smb
10 1 * * 6,0 /etc/init.d/smb restart


#实例9：每天18 : 00至23 : 00之间每隔30分钟重启smb
0,30 18-23 * * * /etc/init.d/smb restart


#实例10：每星期六的晚上11 : 00 pm重启smb
0 23 * * 6 /etc/init.d/smb restart
```

------

---
layout: post
title:  "2021-08-25-ProtoBuf数据协议"
date:   2021-08-25 00:18:23 +0700
categories: [ProtoBuf]
tags:  ProtoBuf
comments: true

---

摘要：ProtoBuf 数据协议

------

## Protocol Buffers介绍

ProtoBuf(Protocol Buffers)是一种跨平台、语言无关、可扩展的序列化结构数据的方法，可用于网络数据交换及数据存储。不同于 `XML` 、`JSON` 这种文本格式数据，Protocol Buffers 是一种二进制格式数据。

### Protocol Buffers协议文件

Protocol Buffers 在使用前需要先定义好协议文件，以 `.proto` 为后缀的文件就是Protocol Buffers 的协议文件。

> **Example**

```protobuf
// 指定protobuf的版本，proto3是最新的语法版本
syntax = "proto3";

// 定义数据结构，message 你可以想象成java的class，c语言中的struct
message Response {
  string data = 1;   // 定义一个string类型的字段，字段名字为data, 序号为1
  int32 status = 2;   // 定义一个int32类型的字段，字段名字为status, 序号为2
}
```

如果 A 和 B 要基于 Protocol Buffers 协议进行通信，那么在通信前，A 和 B 都需要有同一份协议文件，所以在 Protocol Buffers 数据传输过程中，不需要数据的 `Schema` 信息；

## Protocol Buffers软件

值得一提的是，Protocol Buffers 可以安装软件，将指定的 `proto` 协议文件转换为多种编程语言代码，并且提供了序列化和反序列化等一系列方法库。

下载地址： <https://github.com/protocolbuffers/protobuf/releases>

MAC 下安装：

```shell
 brew install protobuf 
 # 安装完成后验证
 protoc --version
```

> **转换为代码**

```shell
# 在当前目录输出 response.proto 协议生成的Java代码
protoc --java_out=. response.proto
```

```xml
<dependency>
   <groupId>com.google.protobuf</groupId>
   <artifactId>protobuf-java</artifactId>
   <version>3.9.1</version>
</dependency>
```

```java
ResponseOuterClass.Response.Builder builder = ResponseOuterClass.Response.newBuilder();
// 设置字段值
builder.setData("hello www.tizi365.com");
builder.setStatus(200);

 ResponseOuterClass.Response response = builder.build();
 // 将数据根据protobuf格式，转化为字节数组
 byte[] byteArray  = response.toByteArray();

// 反序列化,二进制数据
ResponseOuterClass.Response newResponse = ResponseOuterClass.Response.parseFrom(byteArray);
System.out.println(newResponse.getData());
System.out.println(newResponse.getStatus());
```



------

---
layout: post
title:  "Flink-基本架构"
date:   2022-02-23 11:16:23 +0700
categories: [Flink]
tags:   Flink
comments: true
---

摘要： 鸟瞰 Flink 架构，分析 Flink 内部组件工作机制。

------

## Flink 架构图

![Flink架构图]({{ "/assets/img/flink-struct.svg" | relative_url }})

一个完整的 Flink 集群由一个 Jobmanager 和若干个 Taskmanager 组成，Jobmanager 主要负责调度 task 以及 协调 Checkpoint。Taskmanager 则负责具体的 task 执行，以及数据流的交换。 

可以通过多种方式启动 JobManager 和 TaskManager：直接在机器上作为standalone 集群启动、在容器中启动、或者通过YARN等资源框架管理并启动。TaskManager 连接到 JobManagers，宣布自己可用，并被分配工作。

Flink 集群类型一般有以下几种：

* Flink Session 集群

这种模式下，集群自创建开始，最后到集群生命周期结束，不受作业因素影响； 集群下的多个作业共享 内存、网络、磁盘等资源，如果集群出现异常，该集群下的所有作业都会收到影响。

优点：提交作业速度很快，无需提前申请资源； 并且资源利用率较高。

缺点：作业之间隔离性较差，横向扩展不太方便。


* Flink job 集群

这种模式也称 pre-job 模式，集群交由 资源管理器托管，例如 Yarn ，需要运行作业，第一步申请资源，启动一个 Flink 集群，第二步提交作业，这种模式下，每个作业会独享一个 Flink 集群。

优点：作业之间相互隔离，稳定性高，并且不同作业可以根据资源情况灵活调整。

缺点：资源浪费，并且作业启动较慢。


* Flink Application 集群

这种模式也称 Application 模式，这种模式的集群和作业相关，每一个作业独享一个集群，无需事先启动一个集群，而且直接从作业 jar 中提取 JobGraph 执行。这种模式下，每一个作业就是一个 Application ，同时也是一个 Flink 集群。

优点：集群直接相互隔离，可以很好地利用资源；

缺点：暂无。




参考：

<https://nightlies.apache.org/flink/flink-docs-release-1.14/zh/docs/concepts/flink-architecture/>

<https://www.jianshu.com/p/3898dd13f079>

------

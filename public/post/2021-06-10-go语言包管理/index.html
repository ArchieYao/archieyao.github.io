<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
<title>Go语言包管理</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="UA-123456-789">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5, user-scalable=5" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">











  
    
      
    
  








  




<link rel="icon" href="http://localhost:1313/images/github.png">



      <script src="/js/toc.js"></script>
    
    <link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">

<link rel="stylesheet" href="/scss/dark-mode.min.cb53f1bee2b8900cb4f082afbf00175d6618f281cf9a2fe8619e3b52d20b5721.css" integrity="sha256-y1PxvuK4kAy08IKvvwAXXWYY8oHPmi/oYZ47UtILVyE=" media="screen">


<link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Material+Icons">








<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="/vendor/js/md5.min.js"></script><script>
  var gitalk = new Gitalk({
  clientID: '',
  clientSecret: '',
  repo: '',
  owner: '',
  admin: [''],
  id: md5(location.pathname),
  distractionFreeMode: 'false'
  });
  window.onload = function () {
        gitalk.render('gitalk-container')
  }
</script>












</head>
<body>
    	<div id="app"><div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%8c%85%e4%bd%bf%e7%94%a8%e8%a7%84%e8%8c%83" class="nav-包使用规范">
									包使用规范
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9f%ba%e4%ba%8e%e5%8c%85%e7%9a%84%e5%b0%81%e8%a3%85" class="nav-基于包的封装">
									基于包的封装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8c%85%e7%9a%84%e5%88%9d%e5%a7%8b%e5%8c%96" class="nav-包的初始化">
									包的初始化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%b0%81%e8%a3%85%e5%bc%95%e7%94%a8%e5%ae%9e%e4%be%8b" class="nav-封装引用实例">
									封装引用实例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8c%85%e5%bc%95%e7%94%a8" class="nav-包引用">
									包引用
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="http://localhost:1313/">
            MeiK&#39;s blog
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="http://localhost:1313/">
        <div class="single-column-header-title">MeiK&#39;s blog</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    Go语言包管理
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2021-06-10 10:18
                        </time>
                        

                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/go">Go</a>
                                &nbsp;
                            
                        
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <p>摘要：Go语言包管理。</p>
<hr>
<h2 id="包使用规范">包使用规范</h2>
<p>包的习惯用法：</p>
<ul>
<li>包名一般是小写的，使用一个简短且有意义的名称。</li>
<li>包名一般要和所在的目录同名，也可以不同，包名中不能包含- 等特殊符号。</li>
<li>包一般使用域名作为目录名称，这样能保证包名的唯一性，比如 GitHub 项目的包一般会放到GOPATH/src/github.com/userName/projectName 目录下。</li>
<li>包名为 main 的包为应用程序的入口包，编译不包含 main 包的源码文件时不会得到可执行文件。</li>
<li>一个文件夹下的所有源码文件只能属于同一个包，同样属于同一个包的源码文件不能放在多个文件夹下。</li>
</ul>
<blockquote>
<p>Go 语言中，所有的定义，比如函数、变量、结构体等，如果首字母是大写，那么就可以被其他包使用；同一包下，不存在引用问题。</p>
</blockquote>
<h2 id="基于包的封装">基于包的封装</h2>
<p>在Go语言中封装就是把抽象出来的字段和对字段的操作封装在一起，数据被保护在内部，程序的其它包只能通过被授权的方法，才能对字段进行操作。</p>
<p>封装的好处：
隐藏实现细节；
可以对数据进行验证，保证数据安全合理。</p>
<p>封装的实现步骤：</p>
<ol>
<li>将结构体、字段的首字母小写；</li>
<li>给结构体所在的包提供一个工厂模式的函数，首字母大写，类似一个构造函数；</li>
<li>提供一个首字母大写的 Set 方法（类似其它语言的 public），用于对属性判断并赋值；</li>
<li>提供一个首字母大写的 Get 方法（类似其它语言的 public），用于获取属性的值。</li>
</ol>
<h2 id="包的初始化">包的初始化</h2>
<p>每个包都允许有一个 init 函数，当这个包被导入时，会执行该包的这个 init 函数，做一些初始化任务。
对于 init 函数的执行有两点需要注意:</p>
<ol>
<li>init 函数优先于 main 函数执行</li>
<li>在一个包引用链中，包的初始化是深度优先的。比如，有这样一个包引用关系：main→A→B→C，那么初始化顺序为
C.init→B.init→A.init→main</li>
</ol>
<h2 id="封装引用实例">封装引用实例</h2>
<p>建立如下工程结构，在main包中需要访问model包中的内容。</p>
<pre tabindex="0"><code>project
|---src
    |---main
        -main.go
    |---model
        -student.go
</code></pre><p>student.go</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">student</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Name</span>      <span class="kt">string</span>
</span></span><span class="line"><span class="cl">	<span class="nx">idCardNum</span> <span class="kt">string</span> <span class="c1">// 私有，外部包不可访问
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">Age</span>       <span class="kt">int8</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewStudent</span><span class="p">(</span><span class="nx">stuName</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">age</span> <span class="kt">int8</span><span class="p">)</span> <span class="o">*</span><span class="nx">student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">student</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Name</span><span class="p">:</span> <span class="nx">stuName</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="nx">Age</span><span class="p">:</span>  <span class="nx">age</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 定义结构体方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">stu</span> <span class="o">*</span><span class="nx">student</span><span class="p">)</span> <span class="nf">SetIdCardNum</span><span class="p">(</span><span class="nx">idCN</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stu</span><span class="p">.</span><span class="nx">idCardNum</span> <span class="p">=</span> <span class="nx">idCN</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 定义结构体方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">stu</span> <span class="o">*</span><span class="nx">student</span><span class="p">)</span> <span class="nf">GetIdCardNum</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">stu</span><span class="p">.</span><span class="nx">idCardNum</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>main.go</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 引入model包
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;../model&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stu</span> <span class="o">:=</span> <span class="nx">model</span><span class="p">.</span><span class="nf">NewStudent</span><span class="p">(</span><span class="s">&#34;张三&#34;</span><span class="p">,</span><span class="mi">34</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stu</span><span class="p">.</span><span class="nf">SetIdCardNum</span><span class="p">(</span><span class="s">&#34;42093222324234&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="o">*</span><span class="nx">stu</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>运行程序可能会遇到以下错误：</p>
<p>build command-line-arguments: cannot find module for xxxx</p>
<p>该错误与go环境变量GO111MODULE相关：</p>
<ul>
<li>GO111MODULE=off 无模块支持,go 会从 GOPATH 和 vendor 文件夹寻找包</li>
<li>GO111MODULE=on 模块支持,go 会忽略GOPATH 和 vendor 文件夹,只根据 go.mod 下载依赖</li>
<li>GO111MODULE=auto 在 $GOPATH/src 外面且根目录有 go.mod 文件时，开启模块支持</li>
<li>在使用模块的时候，GOPATH 是无意义的,不过它还是会把下载的依赖储存在 $GOPATH/src/mod 中,也会把 go install 的结果放在 $GOPATH/bin 中</li>
</ul>
<p>设置方式：</p>
<pre tabindex="0"><code>go env -w GO111MODULE=auto
go env
</code></pre><p>在main中调用发现只能访问student结构体的Name和Age字段，idCardNum需要通过get方法获取，这样就达到包的权限控制效果。</p>
<h2 id="包引用">包引用</h2>
<p>包引用可使用相对路径和绝对路径；引用时也可以对包设置alias；还可以匿名引用。</p>
<ul>
<li>包省略前缀</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span> <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>这个点的含义就是这个包导入之后在你调用这个包的函数时，你可以省略前缀的包名，也就是前面你调用的 fmt.Println (&ldquo;hello world&rdquo;) 可以省略的写成 Println (&ldquo;hello world&rdquo;)</p>
<ul>
<li>包设置alias</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nx">model1</span> <span class="s">&#34;../model&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stu</span> <span class="o">:=</span> <span class="nx">model1</span><span class="p">.</span><span class="nf">NewStudent</span><span class="p">(</span><span class="s">&#34;张三&#34;</span><span class="p">,</span> <span class="mi">34</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">stu</span><span class="p">.</span><span class="nf">SetIdCardNum</span><span class="p">(</span><span class="s">&#34;42093222324234&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>包匿名引用</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nx">_</span> <span class="s">&#34;../model&#34;</span>
</span></span></code></pre></div><p>注意匿名引用的包并不能直接使用其中的变量和方法，不使用匿名引入的情况下，如果引入了一个未使用的包会导致编译错误，但使用匿名引入包不会导致编译错误。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#34;database/sql&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">_</span> <span class="s">&#34;github.com/lib/pq&#34;</span>              <span class="c1">// enable support for Postgres
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">_</span> <span class="s">&#34;github.com/go-sql-driver/mysql&#34;</span> <span class="c1">// enable support for MySQL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;postgres&#34;</span><span class="p">,</span> <span class="nx">dbname</span><span class="p">)</span> <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;mysql&#34;</span><span class="p">,</span> <span class="nx">dbname</span><span class="p">)</span>    <span class="c1">// OK
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">db</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="s">&#34;sqlite3&#34;</span><span class="p">,</span> <span class="nx">dbname</span><span class="p">)</span>  <span class="c1">// returns error: unknown driver &#34;sqlite3&#34;
</span></span></span></code></pre></div><p>导入一个包，只想执行包里的 init 函数，来运行一些初始化任务，此时也可以使用匿名导入。</p>
<ul>
<li>绝对路径引入</li>
</ul>
<p>基于以上工程目录结构，也可以使用绝对路径引入，绝对路径是从 $GOPATH/src 或 $GOROOT 或者 $GOPATH/pkg/mod 目录下搜索包并导入。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;model&#34;</span>
</span></span></code></pre></div><p>注意绝对路径引入需要保证GOPATH在当前目录下，使用goland也可以设置当前工程的GOPATH。</p>
<ul>
<li>相对路径引入</li>
</ul>
<p>相对路径是从当前目录开始。</p>
<p>main包中引用如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;../model&#34;</span>
</span></span></code></pre></div><p>参考：</p>
<p><a href="https://juejin.cn/post/6844904167073382408">https://juejin.cn/post/6844904167073382408</a>
<a href="http://c.biancheng.net/view/91.html">http://c.biancheng.net/view/91.html</a></p>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">Last modified on 2024-01-24</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="/post/2021-06-15-go%E8%AF%AD%E8%A8%80deferpanicrecover/">
			Next<br>Go语言defer、panic、recover
                </a>
                
                
                
                <a class="older-posts" href="/post/2021-06-09-go%E8%AF%AD%E8%A8%80%E9%80%9A%E9%81%93channel/">
			Previous<br>Go语言channel
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                


<div id="gitalk-container"></div>











            </div>
        </div>
    </div>


                    </div>
            </div><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="http://localhost:1313/">
    
        <div class="nav-title">
            MeiK&#39;s blog
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2024 MeiK&#39;s blog
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    <div class="toc-wrapper">
        

        
        <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- CATALOG -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%8c%85%e4%bd%bf%e7%94%a8%e8%a7%84%e8%8c%83" class="nav-包使用规范">
									包使用规范
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%9f%ba%e4%ba%8e%e5%8c%85%e7%9a%84%e5%b0%81%e8%a3%85" class="nav-基于包的封装">
									基于包的封装
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8c%85%e7%9a%84%e5%88%9d%e5%a7%8b%e5%8c%96" class="nav-包的初始化">
									包的初始化
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%b0%81%e8%a3%85%e5%bc%95%e7%94%a8%e5%ae%9e%e4%be%8b" class="nav-封装引用实例">
									封装引用实例
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%8c%85%e5%bc%95%e7%94%a8" class="nav-包引用">
									包引用
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
        
    </div>
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top"
            :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>

<div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
Ported from <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	2024 MeiK&#39;s blog
	
</div>
            </div>
    
    <script src="/js/journal.js"></script></body>
</html>
